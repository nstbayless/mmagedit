name: 'Build'

on:
  push:
    branches: [ master, main, dev ]
  pull_request:
    branches: [ master, main, dev ]
  schedule:
    # run every saturday at 4:43 AM PST
    - cron: '43 12 * * SAT'
  workflow_dispatch: # can run this manually
jobs:  
  # 32-bit windows build
  build-win32:
    runs-on: windows-latest
    steps:
    
    # sdl2
    - name: Cached SDL2
      id: vcpkg-sdl2
      uses: actions/cache@v3
      with:
        path: |
          C:/vcpkg/installed/
        key: ${{ runner.os }}-vcpkg-sdl

    - name: Install SDL2
      if: steps.vcpkg-sdl2.outputs.cache-hit != 'true'
      run: vcpkg install sdl2 --triplet x64-windows
      
    - name: Cached Python3.6
      id: vcpkg-py36
      uses: actions/cache@v3
      with:
        path: |
          ${{ env.RUNNER_TOOL_CACHE }}/windows/Python\3.6.8\x64
        key: ${{ runner.os }}-py36
      
    # python 3.6 is required for pyinstaller
    # TODO: cache this.
    - name: Set up Python3.6
      uses: actions/setup-python@v4
      with:
        python-version: '3.6'
    - run: python3 -m pip install setuptools==50.3.2
    - run: python3 -m pip install pyinstaller==4.0 -vvv
    - run: python3 -m pip install Pillow
    
    # check that dependencies installed.
    - name: check-dependencies (1)
      run: python3 -c "from PIL import Image, ImageDraw, ImageOps"
     
    - name: check-dependencies (2)
      run: python3 -c "from tkinter import ttk"
        